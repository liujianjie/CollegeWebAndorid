<!doctype html>
<html>
<head>
<meta charset = "utf-8">
<title>PersonalPage</title>
	  <link rel="stylesheet" href="style/Main.css"/>
</head>
<body>
		
	<!--Top开始-->
	<!-- 最上面的一部分显示，左边放图片和文字 右边放 导航栏 -->
	<div class = "topcontent">
		<div class = "topcontentcontent">
			<div class = "topcontentcontentleftdiv">
				<!--topcontentcontentleftdiv里定义了样式使文字在图片水平middle位置-->
				<img src = "images/image_1.png" width="45px" height = "45px" align = "left"> 
				<font size = "5">My   First   Web   Page</font>
			</div>
			<div class="topcontentcontentrightdiv" >
				<nav>
					<ul >
						<li style=""><a onclick = "outMenuLoginAndRegister(this);">Logout</a></li>
						<li style=""><a>Option2</a></li>
						<li style=""><a>Option3</a></li>
					</ul>
					
				</nav>
			</div>
		</div>

	</div>
	<!--Top结束-->


	<!--中间 开始-->
	<!--最外层div -->
	<div id="container">
		<!--下一层div定义了宽度-->
		<div class="maincontent">
			<!--中间容器的左边 开始。左边div占1/3 ，有两个样式 一个定义位置 宽度，一个row 是为了与右边占2/3的div高度相对应，使左边高度多少 右边div高度也多少 更改页面尺寸大小使能不会显示偏移-->
			<div class="leftcontent row">
	
				<div class="leftcontentdiv" >
					<!--同样leftcontentdiv里定义了文字在图片的水平middle位置 -->
					<img id = "LeftProfilePicture" src = "images/image_1.png" width = "80px" height = "80px" > 
					<font size = "5"><span id = "LeftUsername">Username</span></font>
				</div>
					
				<!--使用html5新元素 dl 使呈现列形式，并且自动缩进功能，将左边页面分成3个块 Personal Information、Last Opinions、My Preferences，用dl代表一个块 再写内容进去-->
				<dl class="leftcontentdl" >
					<dl style ="width:100%">
						<div><a href = "#" class = "personalInfoAndLastO" onclick = "outRightPersonalInfo();">Personal Information</a></div>
						<!--下面style使超出的****** 或者 文字 在页面尺寸更改后能自动换行和隐藏 美观-->
						<dl style ="width:100%;word-wrap:break-word;
								word-break:break-all;overflow: hidden;">
							<dd id = "LeftPersonalInfoPlace">
								<span id ="LeftPersonalInfoPlacespan">*****************************************************************************************************************************************************************************************************************************
								</span>
								
							</dd>
						</dl>
						<hr size = "1" color = "#797979" width = "100%" align = "left">
					</dl>
					<dl style ="width:100%">
						<div><a href = "#" class = "personalInfoAndLastO" onclick = "outRightOpinions();">Last Opinions</a></div>
						<dl>
							<dd><a href = "#" onclick = "openAddtionalWindow(this);" id = "res">爱你多一点 餐厅, City,State</a></dd>
							<dd><strong>good good good good</strong></dd>
						</dl>
						<dl>
							<dd><a href = "#" onclick = "openAddtionalWindow(this);" id = "mov">Restourant X, City,State </a></dd>
							<dd><strong>good good good good</strong></dd>
						</dl>
						<dl>
							<dd><a href = "#" onclick = "openAddtionalWindow(this);" id = "aircraft">Restourant X, City,State</a></dd>
							<dd><strong>good good good good</strong></dd>
						</dl>
						<hr size = "1" color = "#797979" width = "100%" align = "left">
					</dl>
					<!-- 让dl横着排 取消默认竖列显示，使用 border样式使dd呈现边框为矩形-->
					<dl style ="width:100%">
						<div >
							<div style = "width:50%;float:left">
								My Preferences
							</div>
							<div style = "width:50%;float:right">
								<img src = "images/image_plus.png" style="float:right" onclick = "addMyPreferences();"> 
							</div>
						</div>
						
						<div  style= "clear:right"></div>

						<dl class="leftcontentmypredl">
							<dd>		
								<dl id = "needAddPlace">
									<dd id = "2">
										Weekend
										<img src = "images/X.png" align = "right" onclick = "removeSelf(this);">
									</dd>
									<dd >
										Volunteer
										<img src = "images/X.png" align = "right" onclick = "removeSelf(this);">
									</dd>
									<dd >
										Friends
										<img src = "images/X.png" align = "right" onclick = "removeSelf(this);">
									</dd>
								</dl>
								
							</dd>
						</dl>
						<!--<dl>-->
					</dl>
				</dl>
			</div>
			<!--中间的左边 结束-->



			<!--中间的右边 开始-->
			<!--样式中定义了2/3位置-->
			<div class="rightcontent row" id = "centerContent">
					

			</div>
			<!--中间的右边 结束-->

		</div>

	</div>
	
	</div>
	<!--中间 结束-->

	

	<!--页脚 开始-->
	<!--使用nav 导航栏 自动排列横行，footer样式中定义了背景颜色，显示位置，字体-->
	<nav class="footer" >
			<img src="images/image_face.png" width="30px" height="30px" style="vertical-align:middle">
			<a href="https://www.facebook.com/">Facebook |</a>
			<img src="images/image_twitter.png" width="30px" height="30px" style="vertical-align:middle">
			<a href="https://www.twitter.com/">Twitter |</a>
			<img src="images/image_vk.png" width="30px" height="30px" style="vertical-align:middle">
			<a href="https://vk.com/">Vine</a>
	</nav>
	<!--页脚 结束-->
	<script type="text/javascript">
		//全局变量
		var reg = new RegExp(/\w+@[a-z0-9]+\.[a-z]*/);
		var pmdreg = new RegExp(/[a-z0-9]{8}/);//bug
		var pmdreg2 = new RegExp(/[a-z0-9]{8,10}/);
		window.onload=function(){
			
			if (document.cookie.length > 0 ){
				
				gCkSetPInfo("leftPerInfo");
			}else{
				alert("Not");
			}
		}
		
		//需要解决bug 重复点击
		function getRegisterStr(){
			var str = '<form method="post" name = "registerfrm" ><table><tr><td>Username</td><td><input type="text" name="Username" id="Username" value = ""></td></tr><tr><td>Password</td><td><input type="password" name="password" id="password"></td></tr>  <tr><td>Name</td><td><input type="text" name="Name" id="Name"></td></tr>  <tr><td>E-mail</td><td><input type="text" name="email" id="email"></td></tr>  <tr><td>Birth date</td><td><input type="date" id="birthdate" name="birthdate"></td></tr>  <tr><td>Profile picture</td><td><input type="file" accept="image/*" name="profilepicture" id="profilepicture"></td></tr> <tr><td>Address</td><td><input type="text" name="Address" id="Address"></td></tr><tr><td colspan="2" align="left"><input type="checkbox" name="agree" id="agree">I have read and accept the Terms of Use<input type="button" onclick = "checkFormSubm();" value="save" ><input type="reset" value="delete"></td></tr></table></form>';
			return str;
		}
		function getLoginStr(){
			var str = '<form method="post" name = "loginfrm"><table><tr><td>Password</td><td><input type="password" name="loginpassword" id="loginpassword"></td><tr><td>E-mail</td><td><input type="text" name="loginemail" id="loginemail"></td></tr> <tr><td colspan = 2 align ="left"><input type="button" value="Login" onclick = "return checkLoginSubm();"/></td></tr></table></form>';
			return str;
		}
		function getRightPersonalInfoStr(){
			var content = "<div class = 'contentDiV'><form method='post' name = 'rightPerInfofrm'><div style='margin-top:3%'><header><font size = '5'>Personal Information</font></header><input style=' width:45%;height:25px;float: left' value='Username' name='rtUsername' id='rtUsername'/><input style=' width:45%;height:25px;float: right' value='Name' name='rtName' id='rtName'/ ></div><div><input style=' width:100%;height:25px;margin-top:3%' value='email' name='rtemail' id='rtemail'/ ></div><div style='margin-top:3%'><input style=' width:45%;height:25px;float: left' value='address' name='rtaddress' id='rtaddress'/ ><input style=' width:45%;height:25px;float: right' value='mobile phone'/ ></div><div ><input type='date' style=' width:100%;height:25px;margin-top:3%' value='birthday' name='rtbirthday' id='rtbirthday'/ ></div></form><header style='margin-top:3%'><font size = '5'>My Activity in the App</font></header><dl class='rightcontentradius'><dd>X<br/>points</dd><dd>2<br/>level</dd><dd>3<br/>opinions</dd><dd>5<br/>photos</dd></dl><div><input type='button' onclick='checkModifyForm();' style=' width:100%;height:25px;margin-top:3%' value='modify'/ ></div></div>";
			
			return content;
		}
		
		function getRightOpinionsStr(){
			
			return "";
		}
		
		function outMenuLoginAndRegister(menu){
			var outRegisterTable = getRegisterStr();
			var outLoginTable = getLoginStr();
			var liNode = menu.parentNode;
			var ulNode = liNode.parentNode;
			var lilength = ulNode.getElementsByTagName("li").length;
			if(lilength < 4){
				var a1 = document.createElement("a");
				var a2 = document.createElement("a");
				var li1 = document.createElement("li");
				var li2 = document.createElement("li");

				a1.textContent = "Register";
				a1.onclick = function(){
					document.getElementById("centerContent").innerHTML = outRegisterTable;
				}
				a2.textContent = "Login";
				a2.onclick = function(){
					document.getElementById("centerContent").innerHTML = outLoginTable;
					document.getElementById("loginpassword").focus();
				}
				li1.appendChild(a1);
				li2.appendChild(a2);
				ulNode.appendChild(li1);
				ulNode.appendChild(li2);
			}
		} 
		function checkModifyForm(){

			var saveusername = gckPersonalInfoByFname("Username");
			var savename = gckPersonalInfoByFname("Name");
			var saveemail = gckPersonalInfoByFname("email");
			var savebirthdate = gckPersonalInfoByFname("birthdate");
			var saveAddress = gckPersonalInfoByFname("Address");

			var password = gckPersonalInfoByFname("password");
			var picture = gckPersonalInfoByFname("profilepicture");
			
			var username = document.rightPerInfofrm.rtUsername.value;
			var name = document.rightPerInfofrm.rtName.value;
			var email = document.rightPerInfofrm.rtemail.value;
			var birthdate = document.rightPerInfofrm.rtbirthday.value;
			var Address = document.rightPerInfofrm.rtaddress.value;
			
			if(username == ""){
				alert("username can not be empty");
				document.getElementById("rtUsername").focus();
				document.getElementById("rtUsername").value = saveusername;
				return false;
			}
			if(name == ""){
				alert("name can not be empty");
				document.getElementById("rtName").focus();
				document.getElementById("rtUsername").value = savename;
				return false;
			}
			if(email == ""){
		　　　　alert("email can not be empty");
				document.getElementById("rtemail").focus();
				document.getElementById("rtemail").value = saveemail;
		　　　　return false;
		　　}else if(!reg.test(email)){ 
		　　　　alert("Please enter the correct mailbox format");
				document.getElementById("rtemail").focus();
		　　　　return false;
		　　}
			if(birthdate == ""){
				alert("birthdate can not be empty");
				document.getElementById("rtbirthday").focus();
				document.getElementById("rtUsername").value = savebirthdate;
				return false;
			}
			if(Address == ""){
				alert("Address can not be empty");
				document.getElementById("rtaddress").focus();
				document.getElementById("rtUsername").value = saveAddress;
				return false;
			}
			var Days = 30;
			var exdate = new Date();
			exdate.setTime(exdate.getTime() + Days*24*60*60*1000);//一月
			/*var exdate=new Date();
			exdate.setDate(exdate.getDate()+365);*/

			document.cookie="Username=" + escape(username) + ",Name=" + escape(name) + ",password=" + escape(password)+ ",birthdate=" + escape(birthdate) +",email=" + escape(email) + ",profilepicture=" + escape(picture) +",Address=" + escape(Address) +";expires = " + exdate.toGMTString();

			alert("Modify Succuss");
			gCkSetPInfo("leftPerInfo");
			return true;
		}
		function checkLoginSubm(){
			var psd = document.loginfrm.loginpassword.value;
			var email = document.loginfrm.loginemail.value;
			
			if(psd == ""){
				alert("password can not be empty");
				document.getElementById("loginpassword").focus();
				return false;
			} if(!pmdreg.test(psd)){ 
				alert("Please enter 8 characters that can only be a~z 0~9");
				document.getElementById("loginpassword").focus();
				return false;
		　　}
			if(email == ""){
		　　　　alert("email can not be empty");
		　　　　return false;
		　　}else if(!reg.test(email)){ 
		　　　　alert("Please enter the correct mailbox format");
		　　　　return false;
		　　}
		    var cookiepwd = gckPersonalInfoByFname("password");
			var cookieemail = gckPersonalInfoByFname("email");
			
			if(cookieemail == ""){
				alert("You have not registered yet, please register and try again");
				return false;
			}
			if(email != cookieemail){
				alert("You are not registered with this email, please log in after registration");
				document.getElementById("loginemail").focus();
				return false;
			}
			if(psd != cookiepwd){
				alert("The passwords do not match. Please  entry again and try again.");
				document.getElementById("loginpassword").focus();
				return false;
			}

			gCkSetPInfo("leftPerInfo");
			outRightPersonalInfo();
			
			return true;
		
		}
		function checkFormSubm(){
			// 2.need check same email
			var username = document.registerfrm.Username.value;
			var password = document.registerfrm.password.value;
			var name = document.registerfrm.Name.value;
			var email = document.registerfrm.email.value;
			var birthdate = document.registerfrm.birthdate.value;
			var picture = document.registerfrm.profilepicture.value;
			var Address = document.registerfrm.Address.value;
			var checkboxs = document.getElementsByName("agree");
			
			if(username == ""){
				alert("username can not be empty");
				document.getElementById("Username").focus();
				return false;
			}
			if(password == ""){
				alert("password can not be empty");
				document.getElementById("password").focus();
				return false;
			} 
			if(!pmdreg.test(password)){ 
				alert("Please enter 8 characters that can only be a~z 0~9");
				document.getElementById("password").focus();
				return false;
		　　}
			if(name == ""){
				alert("name can not be empty");
				document.getElementById("Name").focus();
				return false;
			}
			
			if(email == ""){
		　　　　alert("email can not be empty");
				document.getElementById("email").focus();
		　　　　return false;
		　　} 
		
			if(!reg.test(email)){ 
		　　　　alert("Please enter the correct mailbox format");
				document.getElementById("email").focus();
		　　　　return false;
		　　}
			var checkemail = gckPersonalInfoByFname("email");
			if(email == checkemail){
				alert("there is already associated with the specified email account,Please log in directly");
				return false;
			}

			if(birthdate == ""){
				alert("birthdate can not be empty");
				document.getElementById("birthdate").focus();
				return false;
			}
			if(!picture){
				alert("picture can not be empty");
				document.getElementById("profilepicture").focus();
				return false;
			}
			if(Address == ""){
				alert("Address can not be empty");
				document.getElementById("Address").focus();
				return false;
			}
			
			if(checkboxs[0].checked == false){
				alert("you need accept the Terms of Use");
				document.getElementById("agree").focus();
				return false;
			}
			var Days = 30;
			var exdate = new Date();
			exdate.setTime(exdate.getTime() + Days*24*60*60*1000);//一月
			/*var exdate=new Date();
			exdate.setDate(exdate.getDate()+365);*/

			document.cookie="Username=" + escape(username) + ",Name=" + escape(name) + ",password=" + escape(password)+ ",birthdate=" + escape(birthdate) +",email=" + escape(email) + ",profilepicture=" + escape(picture) +",Address=" + escape(Address) +";expires = " + exdate.toGMTString();
			//document.cookie="password=" + password + ";expires="+exdate.toGMTString();
			//document.cookie="email=" + email + ";expires="+exdate.toGMTString();
			//document.cookie="Username = go;expires="+exdate.toGMTString();

			alert("Registration is successful, please login");
			return true;
		}

		function gckPersonalInfoByFname(f_name){
			var c_end = document.cookie.indexOf(";",0);
			if(c_end != -1){
				var valstr = unescape(document.cookie.substring(0, c_end));
				var valSplitArray = valstr.split(",");
				for(var i in valSplitArray){
					var val = valSplitArray[i];
					var c_middle = val.indexOf("=");
					var c_name = unescape(val.substring(0,c_middle));
					var c_val = unescape(val.substring(c_middle + 1,val.length));
					if(c_name == f_name){
						return c_val;
					}
				}
			}
			return "";
		}
		function gCkSetPInfo(mark){
			/*var c_start = document.cookie.indexOf(selname + "=");
			
			if (c_start!=-1){
				c_start = c_start + selname.length+1;
				var c_end = document.cookie.indexOf(";",c_start);
				var val = unescape(document.cookie.substring(c_start,c_end));
				alert(val);
			}else{
				alert("wu");
			}*/
			//var c_start = document.cookie.indexOf("Username");
			
			var c_end = document.cookie.indexOf(";",0);
			//alert(c_end);
			if(c_end != -1){
				var valstr = unescape(document.cookie.substring(0, c_end));
				//alert(valstr);
				var valSplitArray = valstr.split(",");
				/*document.cookie="Username=" + username + ",Name=" + name +",birthdate=" + birthdate +",profilepicture=" + picture +",Address=" + Address +";expires = " + exdate.toGMTString();*/
				if(mark == "leftPerInfo"){
					var personalStr = "";
					for(var i in valSplitArray){
						var val = valSplitArray[i];
						var c_middle = val.indexOf("=");
						var c_name = unescape(val.substring(0,c_middle));
						var c_val = unescape(val.substring(c_middle + 1,val.length));
						if(c_name == "Username"){
							document.getElementById("LeftUsername").innerHTML = c_val;
						}
						if(c_name == "Name"){
							personalStr += "<p>Name:"+c_val+"</p>";
						}
						if(c_name == "birthdate"){
							personalStr += "<p>birthdate:"+c_val+"</p>";
						}
						if(c_name == "Address"){
							personalStr += "<p>Address:"+c_val+"</p>";
						}
						if(c_name == "profilepicture"){
							document.getElementById("LeftProfilePicture").src = c_val;
						}
					}
					document.getElementById("LeftPersonalInfoPlace").innerHTML = personalStr;
				}else if(mark == "rightPerInfo"){
					//alert(valSplitArray);
					for(var i in valSplitArray){
						var val = valSplitArray[i];
						var c_middle = val.indexOf("=");
						var c_name = unescape(val.substring(0,c_middle));
						var c_val = unescape(val.substring(c_middle + 1,val.length));
						if(c_name == "Username"){
							document.getElementById("rtUsername").value = c_val;
						}
						if(c_name == "Name"){
							document.getElementById("rtName").value = c_val;
						}
						if(c_name == "email"){
							document.getElementById("rtemail").value = c_val;
						}
						if(c_name == "Address"){
							document.getElementById("rtaddress").value = c_val;
						}
						if(c_name == "birthdate"){
							document.getElementById("rtbirthday").value = c_val;
						}
					}
				}
			}
		}

		function outRightPersonalInfo(){
			var content = getRightPersonalInfoStr();
			document.getElementById("centerContent").innerHTML = content;
			gCkSetPInfo("rightPerInfo");
			
		}
		function outRightOpinions(){
			var content = '<div class = "contentDiV"><header><font size = "5">Last Opinions</font></header><!--两个div层 内容都一样--><div class="contentDivdiv"><div class="rightcontentdiv1"><img src="images/image_1.png" align ="left"/></div><!--使用dd标签 使处于图片右边位置 并且排列 使呈现 文字出现在图片的水平 上 中 下 位置--><dd class="rightcontentdd"><dl>Restourant Name</dl><dl>City,   Country</dl><dl>Day,Month, Year</dl></dd><div class="rightcontentdiv2"><header style="width:90%"><span>******************************************************************************************************************************************************************************************************************************************************************</span></header></div></div><div class="contentDivdiv"><div class="rightcontentdiv1"><img src="images/image_1.png"/></div><dd class="rightcontentdd"><dl>Restourant Name</dl><dl>City,   Country</dl><dl>Day,Month, Year</dl></dd><div class="rightcontentdiv2"><header style="width:90%"><span>******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************</span></header></div></div><div><div style="text-align:center;margin-top:30px"><span style="margin-top:30dx">Load More</span></div></div></div>';

			document.getElementById("centerContent").innerHTML = content;
			
		}
		function addMyPreferences(){
			var content = '<dd>Weekend<img src = "images/X.png" align = "right"></dd>';
			var dd = document.createElement("dd");
			var input = document.createElement("input");
			var span = document.createElement("span");
			var ddimg = document.createElement("img");
			var dlplace = document.getElementById("needAddPlace");
			
			input.type = "text";
			input.onblur = function(){
				var val = input.value;
				if(val.trim() == ""){
					dlplace.removeChild(dd);
				}else{
					span.innerHTML = val;
					dd.appendChild(span);
					dd.removeChild(input);
				}
			}
			input.onkeypress = function(e){
				//var eCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;
				if (eCode == 13){// 按下回车
					input.blur();// 调用失去焦点 即运行那段代码
				}
			}
			
			ddimg.onclick = function(){
				dlplace.removeChild(dd);
			}
			ddimg.src = "images/X.png";
			ddimg.align = "right";

			dd.appendChild(input);
			dd.appendChild(ddimg);

			dlplace.appendChild(dd);

			input.focus();
			
		}
		function removeSelf(node){
			var parentnode = node.parentNode;
			var parentparentnode = parentnode.parentNode;
			parentparentnode.removeChild(parentnode);
		}
		function openAddtionalWindow(Opinion){
			var openUrl = "PopupOpinions.html";//弹出窗口的url
			var iWidth=800; //弹出窗口的宽度;
			var iHeight=600; //弹出窗口的高度;
			var iTop = (window.screen.availHeight-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.availWidth-10-iWidth)/2; //获得窗口的水平位置;
			var popup = window.open(openUrl,"","height="+iHeight+", width="+iWidth+", top="+iTop+", left="+iLeft,scrollbars = "yes");
			
			//传入值进去
			var parentDd = Opinion.parentNode;
			var DdText = parentDd.textContent ;
			var infos = DdText.split(",");
			var fullname = "";
			var city = "";
			var state = "";
			for(var val in infos){
				if(val == 0){
					fullname = infos[val];
				}
				if(val == 1){
					city = infos[val];
				}
				if(val == 2){
					state = infos[val];
				}
			}
			var id = Opinion.id;
			if(id == 'res'){
				popup.document.getElementById("showMessage").innerHTML = "<dd id = 'fullname'>full name:"+fullname+"</dd><dd id = 'address'>address:"+city +","+state+"</dd><dd id = 'number of phone'>number of phone:</dd>";
			}
			if(id == 'mov'){
				popup.document.getElementById("showMessage").innerHTML = "<dd id = 'fullname'>full name:"+fullname+"</dd><dd id = 'address'>address:"+city +","+state+"</dd><dd id = 'number of phone'>number of phone:</dd>";
			}
			if(id == 'aircraft'){
				popup.document.getElementById("showMessage").innerHTML = "<dd id = 'fullname'>full name:"+fullname+"</dd><dd id = 'address'>address:"+city +","+state+"</dd><dd id = 'number of phone'>number of phone:</dd>";
			}
			//popup.focus();
		}
	</script>
</body>
</html>